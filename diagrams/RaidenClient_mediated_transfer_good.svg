<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="878px" preserveAspectRatio="none" style="width:821px;height:878px;" version="1.1" viewBox="0 0 821 878" width="821px" zoomAndPan="magnify"><defs><filter height="300%" id="fmxo6cd1kfjib" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="84" x2="84" y1="38.4883" y2="837.7363"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="307" x2="307" y1="38.4883" y2="837.7363"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="545" x2="545" y1="38.4883" y2="837.7363"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="782.5" x2="782.5" y1="38.4883" y2="837.7363"/><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="48" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="55" y="23.5352">Initiator</text><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="48" y="836.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="55" y="857.2715">Initiator</text><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="263" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="270" y="23.5352">Mediator1</text><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="263" y="836.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="270" y="857.2715">Mediator1</text><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="501" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="508" y="23.5352">Mediator2</text><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="501" y="836.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="508" y="857.2715">Mediator2</text><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="751.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="758.5" y="23.5352">Target</text><rect fill="#FEFECE" filter="url(#fmxo6cd1kfjib)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="751.5" y="836.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="758.5" y="857.2715">Target</text><path d="M8,53.4883 L8,93.4883 L157,93.4883 L157,63.4883 L147,53.4883 L8,53.4883 " fill="#FBFB77" filter="url(#fmxo6cd1kfjib)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M147,53.4883 L147,63.4883 L157,63.4883 L147,53.4883 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="14" y="71.0566">Wants to transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="18" y="86.3672">10 tokens to Target</text><path d="M189,108.1094 L189,148.1094 L421,148.1094 L421,118.1094 L411,108.1094 L189,108.1094 " fill="#FBFB77" filter="url(#fmxo6cd1kfjib)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,108.1094 L411,118.1094 L421,118.1094 L411,108.1094 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="195" y="125.6777">BP_I_0 (nonce=4, transferred=10,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="199" y="140.9883">locked=5 locksroot_0)</text><polygon fill="#A80036" points="295,205.6621,305,209.6621,295,213.6621,299,209.6621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="301" y1="209.6621" y2="209.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="91" y="174.2988">LockedTransfer(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="95" y="189.6094">(HTL, BP_I_1, initiator_address,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="95" y="204.9199">target_address)</text><path d="M189,222.6621 L189,262.6621 L421,262.6621 L421,232.6621 L411,222.6621 L189,222.6621 " fill="#FBFB77" filter="url(#fmxo6cd1kfjib)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,222.6621 L411,232.6621 L421,232.6621 L411,222.6621 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="195" y="240.2305">BP_I_1 (nonce=5, transferred=10,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="199" y="255.541">locked=15 locksroot_1)</text><polygon fill="#A80036" points="533,320.2148,543,324.2148,533,328.2148,537,324.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="307" x2="539" y1="324.2148" y2="324.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="314" y="288.8516">LockedTransfer(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="318" y="304.1621">(HTL, BP_M1_1, initiator_address,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="318" y="319.4727">target_address)</text><polygon fill="#A80036" points="771,380.1465,781,384.1465,771,388.1465,775,384.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545" x2="777" y1="384.1465" y2="384.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="552" y="348.7832">LockedTransfer(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="556" y="364.0938">(HTL, BP_M2_1, initiator_address,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="556" y="379.4043">target_address)</text><polygon fill="#A80036" points="95,440.0781,85,444.0781,95,448.0781,91,444.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="89" x2="782" y1="444.0781" y2="444.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="101" y="408.7148">SecretRequest(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="105" y="424.0254">(amount, secrethash,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="105" y="439.3359">signature)</text><polygon fill="#A80036" points="771,484.6992,781,488.6992,771,492.6992,775,488.6992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="777" y1="488.6992" y2="488.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="91" y="468.6465">RevealSecret(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="95" y="483.957">(secret, signature)</text><polygon fill="#A80036" points="556,529.3203,546,533.3203,556,537.3203,552,533.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="550" x2="782" y1="533.3203" y2="533.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="562" y="513.2676">RevealSecret(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="566" y="528.5781">(secret, signature)</text><polygon fill="#A80036" points="771,558.6309,781,562.6309,771,566.6309,775,562.6309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545" x2="777" y1="562.6309" y2="562.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="552" y="557.8887">Secret(MSG) BP_M2_2</text><polygon fill="#A80036" points="318,603.252,308,607.252,318,611.252,314,607.252" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="312" x2="544" y1="607.252" y2="607.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="324" y="587.1992">RevealSecret(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="328" y="602.5098">(secret, signature)</text><polygon fill="#A80036" points="533,632.5625,543,636.5625,533,640.5625,537,636.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="307" x2="539" y1="636.5625" y2="636.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="314" y="631.8203">Secret(MSG) BP_M1_2</text><polygon fill="#A80036" points="95,677.1836,85,681.1836,95,685.1836,91,681.1836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="89" x2="306" y1="681.1836" y2="681.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="101" y="661.1309">RevealSecret(MSG)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="105" y="676.4414">(secret, signature)</text><polygon fill="#A80036" points="295,706.4941,305,710.4941,295,714.4941,299,710.4941" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="301" y1="710.4941" y2="710.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="91" y="705.752">Secret(MSG) BP_I_2</text><path d="M189,723.4941 L189,763.4941 L421,763.4941 L421,733.4941 L411,723.4941 L189,723.4941 " fill="#FBFB77" filter="url(#fmxo6cd1kfjib)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M411,723.4941 L411,733.4941 L421,733.4941 L411,723.4941 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="195" y="741.0625">BP_I_2 (nonce=6, transferred=20,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="199" y="756.373">locked=5 locksroot_0)</text><path d="M182,778.1152 L182,818.1152 L427,818.1152 L427,788.1152 L417,778.1152 L182,778.1152 " fill="#FBFB77" filter="url(#fmxo6cd1kfjib)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M417,778.1152 L417,788.1152 L427,788.1152 L417,778.1152 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="188" y="795.6836">locked, locksroot can vary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="192" y="810.9941">if there are other pending transfers</text><!--
@startuml
participant Initiator
participant Mediator1
participant Mediator2
participant Target

Note over Initiator: Wants to transfer \n 10 tokens to Target

Note over Mediator1: BP_I_0 (nonce=4, transferred=10,\n locked=5 locksroot_0)

Initiator -> Mediator1: LockedTransfer(MSG) \n (HTL, BP_I_1, initiator_address,\n target_address)

Note over Mediator1: BP_I_1 (nonce=5, transferred=10,\n locked=15 locksroot_1)

Mediator1 -> Mediator2: LockedTransfer(MSG) \n (HTL, BP_M1_1, initiator_address,\n target_address)
Mediator2 -> Target: LockedTransfer(MSG) \n (HTL, BP_M2_1, initiator_address,\n target_address)
Target -> Initiator: SecretRequest(MSG) \n (amount, secrethash,\n signature)
Initiator -> Target: RevealSecret(MSG) \n (secret, signature)
Target -> Mediator2: RevealSecret(MSG) \n (secret, signature)
Mediator2 -> Target: Secret(MSG) BP_M2_2
Mediator2 -> Mediator1: RevealSecret(MSG) \n (secret, signature)
Mediator1 -> Mediator2: Secret(MSG) BP_M1_2
Mediator1 -> Initiator: RevealSecret(MSG) \n (secret, signature)
Initiator -> Mediator1: Secret(MSG) BP_I_2

Note over Mediator1: BP_I_2 (nonce=6, transferred=20,\n locked=5 locksroot_0)

Note over Mediator1: locked, locksroot can vary \n if there are other pending transfers
@enduml

PlantUML version 1.2018.08(Sun Jun 24 20:31:00 HKT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_121-b15
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>